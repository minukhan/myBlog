
## N+1 문제란 무엇인가?

- 연관관계가 설정된 엔티티를 조회할때 발생
- 조회된 데이터의 갯수(N) 만큼 연관관계의 조회 쿼리가 추가로 발생하는걸 말함.

- ex) 
	- 블로그 게시글과 댓글이 있는경우
	- 게시글을 조회한 후 댓글을 조회하기 위한 쿼리가 추가로 발생

### 여기서 알아야할 점

- findAll() 메서드를 사용했을때 fetch 타입이 Eager 로 되어있다면 N+1 발생.
- 그게 아니라 fetch 타입이 lazy로 되어있다면 처음에는 발생 안함.
	- 프록시 객체로 채워넣기 때문에 처음에는 쿼리가 실헹되지 않지만 접근할때마다 쿼리 발생.
- 그러나 실제 연관 엔티티 접근할때 발생. 

- `findAll()` 같은 JPQL 기반 쿼리는 글로벌 패치 전략을 무시하고 쿼리를 날립니다.


## N+1 해결방법

- Fetch Join 을 사용한다.
- EntityGraph 를 사용한다.
- QueryDSL or DTO Projection 을 사용한다.

>[!important] 결론
>문제는 “한 번에 많은 데이터를 가져오는 것”이 아니라,  
“필요 이상의 **쿼리가 많이 실행**되는 것”이 문제임.