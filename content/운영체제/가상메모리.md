
### 가상 메모리란?

관련 개념: [[프로세스]], [[메모리의 연속 할당 방식]], [[세그멘테이션, 페이징 차이점]], [[캐시 메모리]], [[페이지 교체 알고리즘]]

- 실제 물리적 메모리 (RAM) 의 크기에서 벗어나서 메모리를 확장 및 무한대로 보이게 하는 기술

- 보조기억장치의 일부를 주 메모리처럼 이용한다. 
- 이렇게 하면 실제 물리적 메모리보다 훨씬 큰 프로그램을 프로세스에 할당할 수 있음. 

#### 장점? 

- 프로세스가 독립적인 주소공간을 갖게되어서 서로 메모리 영역을 침범하지 않음. 
- 실제 메모리 크기에 관계없이 더 많은 프로세스를 실행.
- 동일한 라이브러리를 이용하는 여러 프로세스 간의 페이지를 공유할 수 있음. 

#### 가상 메모리가 가능한 이유??

- 지역성의 원리때문이다. 
- 프로세스는 실행되는 동안 프로세스는 실행되는 동안 전체 코드와 데이터중 일부만 사용한다. 
- 일부만 사용하니까 당장 사용하는것만 실제 물리적 메모리에 로드하고 나머지는 보조기억장치에 두는 것. 
 -> 페이지 교체를 통해서 나중에 필요한거 다시 재적재. 


### 알아두면 좋은것 혼동 주의!!

##### 1. **CPU 관리 단위: 컨텍스트 스위칭**

- 대상: **프로세스 / 스레드**
- 바뀌는 것:
    - 레지스터 값
    - 프로그램 카운터 (다음 실행할 명령어 위치)
    - 스택 포인터, 상태 레지스터 등
- 상황: CPU가 실행할 프로세스를 바꿀 때
    
##### 2. **메모리 관리 단위: 페이지 교체**

- 대상: **페이지(Page)**
- 바뀌는 것:
    - 페이지 테이블 항목 (가상 주소 ↔ 물리 주소 매핑)
    - RAM ↔ 보조기억장치 사이의 데이터
- 상황: 페이지 폴트가 발생했을 때

### Page-Fault 가 일어나면? 

- 트랩이 발생.
	- CPU 는 이를 감지하고 제어권을 운영체제로 넘김. 
- 페이지 교체 알고리즘 실행. 
	- 물리적 메모리에 빈 공간이 있는지 확인. 없으면 LRU, FIFO 를 통해 교체할 프레임 선택.
	- 비어진 프레임에 원하는 페이지를 보조기억장치에서 찾아 로드. 
- 페이지 폴트를 유발했던 명령어를 다시 실행. 


### **페이지 크기에 대한 Trade-Off**

##### 페이지 크기가 커지면? 

- 페이지 테이블의 크기가 작아진다.
- 페이지 폴드가 일어나면 한번에 많은 데이터를 가져오므로 공간 지역성 활용에 유리.
- 그러나 내부 단편화가 커진다. (필요한 공간보다 더 페이지 크기가 클경우 낭비.)

##### 페이지 크기가 작아지면? 

- 내부 단편화가 줄어든다. 
- 페이지 테이블 크기가 커져서 메모리 낭비가 심해진다. 

![](https://i.imgur.com/7liMjXM.png)

### 페이지 크기가 커지면 페이지 폴트가 더 많이 발생??

- 꼭 그런것은 아님. 
- 오히려 공간 지역성을 잘 활용해서 페이지 폴트가 줄어들 수 있음. 



















